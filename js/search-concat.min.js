if(window.clUnsupportedBrowser)throw"unsupported browser";$.widget("custom.dropdown",{options:{onSelect:function(){}},_create:function(){this._setDropdownToCurrentSelection(),this._on(this.element,{click:function(e){$(this.element).children(".dropdown-list").hasClass("dropdown-show")?(this._closeDropdown(),this._unfocus(),this.options.onSelect(e),this._setDropdownToCurrentSelection()):(e.preventDefault(),this._openDropdown())},keydown:function(e){var t=$(e.target),n=$(this.element),a=n.find(".dropdown-list"),o=0<n.length,n=Number(e.which);27!==n?13!==n?o&&(!a.hasClass("dropdown-show")&&0<=[9,13,32,38,40].indexOf(n)?(e.preventDefault(),this._openDropdown()):(e.preventDefault(),this._navigateMenu(e,n,t))):this.options.onSelect(e):this._closeDropdown()}}),this._on(this.element,{updateView:function(){this._setDropdownToCurrentSelection()}}),this._on(this.document,{click:function(e){$(this.element).find(".dropdown-list").hasClass("dropdown-show")&&this._shouldCloseOnDocumentClick(e)&&(this._unfocus(),this._closeDropdown())}})},_openDropdown:function(){$(this.element).children(".dropdown-list").addClass("dropdown-show").parent(".dropdown").attr("aria-expanded","true")},_closeDropdown:function(){$(this.element).children(".dropdown-list").removeClass("dropdown-show").parent(".dropdown").attr("aria-expanded","false"),this._setDropdownToCurrentSelection()},_unfocus:function(){$(":focus").trigger("blur")},_shouldCloseOnDocumentClick:function(e){return!$(e.target).closest(".dropdown").length},_selectNextTabbable:function(){var e=$(":tabbable"),t=$(":focus"),n=0;0<this.element.parents(".search-view").length?$(".search-sort .sel a").trigger("focus"):(1!==t.length||(t=e.index(t))+1<e.length&&(n=t+1),e.eq(n).trigger("focus"))},_selectPrevTabbable:function(){var e=$(":tabbable"),t=$(":focus"),n=e.length-1;0<this.element.parents(".search-sort").length?$(".search-view .sel button").trigger("focus"):(1!==t.length||0<(t=e.index(t))&&(n=t-1),e.eq(n).trigger("focus"))},_navigateMenu:function(e,t,n){var a,o=n.parents(".dropdown-item"),i=$(this.element).find(".dropdown-list"),n=9===t&&!e.shiftKey,e=9===t&&e.shiftKey;if(40===t||n){if((a=o.is(":last-child"))&&n)return this._selectNextTabbable(),void this._closeDropdown();a=a?i.children().first():o.next()}else{if(38!==t&&!e)return;if((t=o.is(":first-child"))&&e)return this._selectPrevTabbable(),void this._closeDropdown();a=t?i.children().last():o.prev()}o.attr("aria-selected",!1).removeClass("sel").trigger("blur"),a.attr("aria-selected",!0).addClass("sel").children("button, a").trigger("focus")},_setDropdownToCurrentSelection:function(){var e,t=$(this.element),n=t.hasClass("dropdown-sort"),a=t.hasClass("dropdown-view"),o=t.find(".sel [data-selection]").data("selection"),i=CL.page.viewMode,r=t.data("defaultSort")||"date";o&&(a&&o!==i&&(e=$("[data-selection="+i+"]").closest(".dropdown-item")),n&&o!==r&&(e=$("[data-selection="+r+"]").closest(".dropdown-item")),e&&(t.find(".dropdown-item").attr("aria-selected",!1).removeClass("sel").trigger("blur"),e.attr("aria-selected",!0).addClass("sel").children("button, a")))}}),function(){var a=window.cl,o=0,i=[],r={},s=[],c="maps_visited_pids_v1",l="maps_visited_cids_v1",u="maps_visited_cids_mru_v1",d=500;function t(e,t){return t-e}function p(e){return Number.isSafeInteger(e)&&0<e?e:0}function e(e){return e+""}function f(e){return"string"==typeof e&&e.length&&(e=a.safeJsonParse("["+e+"]")),Array.isArray(e)&&e.every(p)?e.sort(t):0}function h(e){o.setJsonItem(c,i=e)}function m(e,t){o.setJsonItem(l,r=e),o.setJsonItem(u,s=t)}function n(e,t,n,a){var o=e.indexOf(t);-1!==o&&e.splice(o,1),e.unshift(t);n=e.splice(n);a&&n.forEach(a)}function g(e,t){var n={},e=e.filter(function(e){return!n[e]&&(n[e]=1)});return e.splice(t),e}function v(t,n){var a=!1,o={},e=n.filter(function(e){return t[e]&&!o[e]&&(o[e]=1)});return Object.keys(t).forEach(function(e){o[e]||(a=!0,delete t[e])}),e.splice(d).forEach(function(e){a=!0,delete t[e]}),e.length!==n.length&&(a=!0,n.splice(e.length),e.forEach(function(e,t){n[t]=e})),a}a.searchMapsVisitedCache={visitPosting:function(e){(e=p(Number(e)))&&(n(i,e,1e3),h(i))},isPostingVisited:function(e){return-1!==i.indexOf(Number(e))},visitCluster:function(e,t){e+="",t=f(t),e&&t&&(n(s,e,d,function(e){delete r[e]}),r[e]=t,m(r,s))},isClusterVisited:function(e,t){t=f(t);var n=r[e];return t&&n&&t.length===n.length&&t.every(function(e,t){return n[t]===e})},init:function(e){try{var t,n;i=(o=e).getJsonItem(c)||[],r=o.getJsonItem(l)||{},s=o.getJsonItem(u)||[],Array.isArray(i)?(t=i.length,(i=g(i.filter(p),1e3)).length!==t&&h(i)):h([]),"object"==typeof r&&Array.isArray(s)?(t=s.length,n=(s=g(s,d)).length!==t,Object.keys(r).forEach(function(e){e+""&&f(r[e])||(n=!0,delete r[e])}),(v(r,s)||n)&&m(r,s)):m({},[]);try{[window.localStorage,o].forEach(function(t){for(var e=[],n=0,a=t.length;n<a;n++){var o=t.key(n);o.match(/^(\d+)|([^:]+:(\d+))$/)&&e.push(o)}e.forEach(function(e){t.removeItem(e)})})}catch(e){}}catch(e){a.unexpected(e)}},get visitedPostingIds(){return i},get visitedClusterIds(){return r},get visitedClusterMru(){return s},VISITED_PIDS_KEY:c,VISITED_CIDS_KEY:l,VISITED_CIDS_MRU_KEY:u,MAX_VISITED_PIDS:1e3,MAX_VISITED_CIDS:d,validatePostingId:p,validateClusterId:e,validateClusterValue:f,ensureVisitedClusterConsistency:v}}(),function(){function i(e){e.find(".viewcontainer").toggleClass("pics info"),e.filter(".viewcontainer").toggleClass("pics info")}function s(e){var t=["posting","cluster"],n=t.indexOf(e);-1!==n&&(delete t[n],t=t.join(" "),o.addClass(e).removeClass(t))}function t(){var t,e=$(".lbframe"),n=parseInt(e.css("top"),10),a={transform:"","-webkit-transform":"","-ms-transform":""};n<0&&(n=1+2*n/e.height(),t="scale("+n+", "+n+")",Object.keys(a).forEach(function(e){a[e]=t})),e.css(a)}function c(e){M.activeMarker=e,CL.page.isMobile?CL.lightbox(o,{afterCenter:t}):M.openPopup=L.popup({offset:L.point(1,-5),autoPanPadding:[50,5]}).setLatLng(e.getLatLng()).setContent(o[0]).openOn(M.map)}function w(){CL.page.isMobile?CL.lightbox.close():M.openPopup&&M.map.closePopup(M.openPopup)}function l(e,t){$("#postbubble").find(".title").toggleClass("banished",t),$("#clusterbubble").find('.posting[data-pid="'+e+'"]').toggleClass("banished",t)}var n,u,a,o,d,p,k=$("#map"),r=$(".zoom-out-for-more"),e=r.find("a"),f=r.find(".total"),y=cl.searchMapsVisitedCache,h={},_=$("<div>"+(window.currencySymbol||"")+"</div>").text();CL.banish.events.on("banish unbanish",function(e,t){var n=M.marker.containingPID[t];n&&("banish"===e.type?(n.banishedCount++,n.unbanishedCount--):"unbanish"===e.type&&(n.banishedCount--,n.unbanishedCount++),M.marker.updateIcon(t)),"map"===CL.page.viewMode&&M.openPopup&&M.activeMarker&&-1!==M.activeMarker.options.pids.indexOf(t)&&("banish"===e.type?(l(t,!0),CL.page.showBanished||(0===n.unbanishedCount?w():1<n.banishedCount+n.unbanishedCount&&$(".backtolist").click())):"unbanish"===e.type&&l(t,!1),M.marker.updateIcon(n.marker)),CL.maps.countMarkers()});function m(t,e){CL.favorites.init(t.find(".icon-star"),function(){M.marker.updateIcon(M.activeMarker)}),t.find(".contenttoggle a").off("click touchstart").on("click touchstart",function(e){e.preventDefault(),i(t)}),CL.swipe.makeGallery(t),v(t,e);var n=document.querySelector(".show-contact"),e=n&&document.querySelector(".viewpostinglink");n&&e&&(n.href=e.href,n.target="_blank")}function x(){CL.maps.isFrozen||(this.title&&this.marker&&!M.openPopup?(M.activeMarker=this.marker,M.openPopup=L.popup({offset:L.point(1,-5),closeButton:!1,autoPan:!1,isTitlePreview:!0}).setLatLng(this.marker.getLatLng()).setContent('<div style="margin: -10px 0;">'+this.title+"</div>").openOn(M.map)):M.openPopup&&M.openPopup.options.isTitlePreview&&w())}function I(e){CL.maps.fullsizeMap();var t=e.target;function n(e){d.html(e),s("cluster"),c(t),p.off("click").on("click",".backtolist",function(){s("cluster"),CL.lightbox.center(),CL.favorites.init(d.find(".icon-star"),function(){M.marker.updateIcon(t)})}),d.off("click").on("click",".posting",function(){var t=$(this).addClass("visited").data("pid"),e=b(t);y.visitPosting(t),p.html(e.dom()),s("posting"),l(t,CL.banish.isBanished(t)),e.buildMapBubble(function(e){p.html(e.dom()),l(t,CL.banish.isBanished(t)),m(p,t)}),CL.maps.openPopup?CL.maps.openPopup._adjustPan():CL.lightbox.center()}),e.each(function(e,t){var n=$(t),t=n.data("pid");l(t,CL.banish.isBanished(t)),v(n,t)}),CL.favorites.init(d.find(".icon-star"),function(){M.marker.updateIcon(t)})}M.activeMarker=t;var a="";p.addClass("iscluster");var o=CL.url.params();["s"].forEach(function(e){delete o[e]});var i=decodeURI(this.url+"&"+$.param(o)),r=this.PostingID,e=this.GeoCluster;y.visitCluster(e,r),t.options.visited=!0,M.marker.updateIcon(t),h[i]?n(h[i]):$.getJSON(i).done(function(e){e[0].forEach(function(e){var t;e.visited=y.isPostingVisited(e.PostingID)?"visited":"",e.ImageThumb&&0<e.ImageThumb.indexOf(",")&&(t=e.ImageThumb.split(","),e.ImageThumb=t[0]+"_50x50c.jpg"),e.ImageThumb||(e.ImageThumb="/images/peace-sm.jpg"),b(e.PostingID).data(e),a+=L.Util.template(u,e)}),e=$(a),h[i]=e,n(e)})}function D(e){CL.maps.fullsizeMap();var t=this.PostingID,n=b(t);n.data()||n.data(this),e=e.target,(M.activeMarker=e).options.visited=!0,M.marker.updateIcon(e),p.removeClass("iscluster"),y.visitPosting(t),p.html(n.dom()),s("posting"),c(e),l(t,CL.banish.isBanished(t)),v(p,t),n.buildMapBubble(function(e){p.html(e.dom()),l(t,CL.banish.isBanished(t)),m(p,t)})}function S(){M.openPopup&&M.openPopup._map&&M.openPopup._adjustPan()}var g,v=function(e,t){CL.banish.ready.done(function(){e.find(".map-banish-unbanish").find(".banish").off("click").on("click",{pid:t},function(e){CL.banish.ban(e.data.pid),L.DomEvent.stopPropagation(e)}).end().find(".unbanish").off("click").on("click",{pid:t},function(e){CL.banish.unban(e.data.pid),L.DomEvent.stopPropagation(e)}),CL.maps.countMarkers()}).fail(function(){e.find(".map-banish-unbanish").hide()})},M=CL.maps,b=(g={},C.prototype.buildMapBubble=function(n){var a=g[this.id()],o=this;return a.data.fullyLoaded?"function"==typeof n&&n(o):$.get(a.data.PostingURL).done(function(e){var t=function(e){var t,n,a,o,i=e.match(/imgList\s+=\s+(\[[^\]]*\])/);if(i&&2===i.length)try{i=JSON.parse(i[1])}catch(e){i=[]}else i=[];return i=i.map(function(e){return(e.url||"").replace(/600x450/,"300x300")}),n=(t=$(e)).find("#postingbody"),a=t.find("#display-date time"),o=t.find(".attrgroup"),e=t.find(".bigattr"),0===n.length&&(n=t.find(".userbody")),{imgList:i,$postingBody:n,$attrs:o,$bigattr:e,$postedDate:a}}(e),e=t.imgList;a.data.imgList=e,a.dom.find(".infocontainer").append(t.$attrs,t.$bigattr,t.$postingBody),a.dom.find(".timecontainer").replaceWith(t.$postedDate),e.length?(a.dom.find(".swipe-wrap").html(e.map(function(e){return'<div><img src="'+e+'" /></div>'}).join("")),a.dom.find(".contenttoggle").show()):(a.dom.find(".swipe").remove(),i(a.dom)),a.dom.removeClass("loading"),a.data.fullyLoaded=!0,"function"==typeof n&&n(o)}),o},C.prototype.clear=function(){return g[this.id()]={},this},C.prototype.data=function(e){var t=g[this.id()];return e?(t.data=t.data||{},e.currencySymbol=_,e.hasPrice=e.price||0===e.price?"":"no",e.BedroomsContent=e.bedrooms?e.bedrooms+"BR":"",$.extend(t.data,e),t.dom=$(L.Util.template(a,t.data)).find(".icon-star").data("pid",this.id()).end(),this):t.data},C.prototype.dom=function(){return g[this.id()].dom.clone()},function(e){return new C(e)});function C(e){var t=e;g[t]||(g[t]={}),this.id=function(){return t}}function P(e,t){var n;M.map?M.map.setView(e,t):(M.map=new L.Map("map",{center:e,zoom:t,minZoom:1,maxZoom:17,maxBounds:[[-90,-180],[90,180]],layers:[M.tilelayer],zoomControl:!1}),CL.maps.controls={},n=new L.Control.ZoomFS,CL.maps.controls.fullsize=n,M.map.addControl(CL.maps.controls.fullsize),$(".close-full-screen-map-mode-button").on("click",function(){n.fullscreen()}),t=L.control.scale({metric:"US"!==window.areaCountry,imperial:"US"===window.areaCountry,updateWhenIdle:!0}),M.map.addControl(t),M.map.attributionControl.setPrefix(""))}function A(e){var t=$("#mapcontainer"),b=new L.LatLng(t.data("arealat"),t.data("arealon")),C=10;P(b,C),$.getJSON(e).done(function(v){cl.localStorage.then(function(e){y.init(e);var t=v[0],n=v[1],a=t.length;navigator.userAgent.match(/iPhone OS 7/)&&500<a&&(t.length=a=500);var o,e=(o=CL.localStorage.getJsonItem("mapBounds",!0),(e=o&&"object"==typeof o&&2===o.length)&&CL.maps.map.fitBounds(o),CL.localStorage.removeItem("mapBounds",!0),e);0<a&&!e&&(e=n.clat,g=n.clng,b=new L.LatLng(e,g),g=n.zoom,17<(C=1<g?g:15)&&(C=17),P(b,C)),postalLat&&postalLon&&0<searchDistance&&L.circle([postalLat,postalLon],parseInt(searchDistance),{color:"#777777",weight:1,fillOpacity:.07}).addTo(M.map);n=new L.MarkerClusterGroup({chunkedLoading:!0,chunkInterval:100,zoomToBoundsOnClick:!1,spiderifyOnMaxZoom:!1,showCoverageOnHover:!1,animate:!1,maxClusterRadius:64,disableClusteringAtZoom:17,iconCreateFunction:function(e){var t=0,n=0,a=!1;return e.getAllChildMarkers().forEach(function(e){t+=e.options.numposts,a=a||e.options.visited,n+=M.marker.containingPID[e.options.pids[0]].unbanishedCount}),isNaN(n)&&(n=t),M.makeIcon({unbanishedCount:n,totalCount:t,visited:a,cluster:!0,fav:!1,marker:e})}});n.on("clusterclick",CL.maps.fullsizeMap);for(var i=[],r=0,s=0;s<a;s++){var c,l,u,d,p=t[s],f=Number(p.NumPosts)||1,h=p.PostingID;1<f?(c=y.isClusterVisited(p.GeoCluster,h),u=h.split(",").map(Number).sort(),(l=CL.maps.marker.create(p.Latitude,p.Longitude,{visited:c,numposts:f,posteddate:1e3*p.PostedDate,pids:u})).on("click",I,p)):(c=y.isPostingVisited(h),u=[Number(h)],d=p.price?'<span class="price">'+_+p.price+"</span> - ":"",d+=p.PostingTitle,(l=CL.maps.marker.create(p.Latitude,p.Longitude,{visited:c,numposts:1,posteddate:1e3*p.PostedDate,pids:u})).on("click",D,p).on("mouseover",x,{title:d,marker:l}).on("mouseout",x)),M.marker.updateIcon(l),B[h]=l,i.push(l),r++}n.addLayers(i);var m,g=$("#mapcontainer");0===r&&(m=$("#noresult-overlay, #noresult-text")).css("line-height",g.height()+"px").addClass("visible").on("click",function(){m.removeClass("visible")}),M.map.addLayer(n),CL.maps.countMarkers(),k.removeClass("loading"),M.map.on("popupopen",function(e){e.popup===M.openPopup&&(e.popup._close(1),M.openPopup=void 0)}).on("popupclose",function(){M.openPopup=void 0}).on("enterFullscreen",function(){S()}).on("exitFullscreen",function(){CL.page.isMobile&&w(),S(),CL.maps.countMarkers()}).on("moveend",function(){CL.maps.countMarkers()});n.on("clusterclick",function(e){var t=e.latlng,n=M.map.getZoom(),e=M.map.getBoundsZoom(e.layer.getConvexHull()),n=n+Math.round((e-n)/2);M.map.setView(t,n)}),CL.maps.ready.resolve(M.map)})})}var B={};Object.assign(CL.maps||(CL.maps={}),{init:function(){n=$("#popuptemplate").html().trim(),u=$("#clustertemplate").html().trim(),a=$("#postingtemplate").html().trim(),o=$(n),d=o.find("#clusterbubble"),p=o.find("#postbubble"),o.on("click",function(e){e.stopPropagation()}),$(window).on("resize",function(){CL.lightbox.center()}),$(document).on("keydown",function(e){e.shiftKey&&k.addClass("xhair")}).on("keyup",function(e){e.shiftKey||k.removeClass("xhair")}),L.Icon.Default.imagePath="//www.craigslist.org/images/map/",M.tilelayer=new L.TileLayer(M.clMapsUrl,{subdomains:"0123456789",setView:!0,enableHighAccuracy:!0,attribution:'&copy; craigslist - Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> - <a href="https://forums.craigslist.org/?forumID=3132">Report a problem</a>'});var e=["jsonsearch",window.catAbb||"fav"];window.subarea&&e.push(window.subarea),e.push(window.location.search);e=decodeURIComponent("/"+e.join("/"));A(e),CL.maps.init=CL.util.noop},countMarkers:function(){var t,n,a,o,e=CL.maps.map;e&&"map"===CL.page.viewMode&&(t=CL.maps.marker.byID,a=n=0,o=e.getBounds(),Object.keys(t).forEach(function(e){e=t[e];a+=e.unbanishedCount,o.contains(e.marker.getLatLng())&&(n+=e.unbanishedCount)}),$(".displaycountShow").text(n),f.text(a),n<a?r.show():r.hide())},ready:new $.Deferred,zoomToPosting:function(n){this.ready.done(function(e){var t=B[n];t&&e&&(e.setView(t.getLatLng(),17,{animate:!1}),t.fireEvent("click"))})},fullsizeMap:function(){$("button#mapview").click(),$("ul.dropdown-list").removeClass("dropdown-show"),$(".leaflet-control-zoom").length&&CL.maps.map.removeControl(CL.maps.controls.fullsize),CL.maps.map&&CL.maps.map.addControl(CL.maps.controls.fullsize),$("#mapcontainer").css({height:"99%"}),CL.maps.thawMap()},inlineMap:function(){CL.maps.init(),CL.maps.map.removeControl(CL.maps.controls.fullsize),$("#map").on("click",CL.maps.fullsizeMap),CL.maps.freezeMap()},storeCurrentBounds:function(){var e,t;"map"===CL.page.viewMode&&CL.maps&&CL.maps.map&&CL.maps.resetBoundsOnReload&&(e=(t=CL.maps.map.getBounds()).getNorthWest(),t=t.getSouthEast(),t=[[e.lat,e.lng],[t.lat,t.lng]],CL.localStorage.setJsonItem("mapBounds",t,!0))},resetBoundsOnReload:!0,turnOffResetBoundsOnReload:function(){CL.maps.resetBoundsOnReload=!1},zoomOut:function(){var e=Math.max(4,CL.maps.map.getZoom()-1);CL.maps.map.setZoom(e)}}),e.click(function(e){e.preventDefault(),CL.maps.zoomOut()})}(),function(){var n,a,o,i,r,t,s,c,l,u,d,p,f,h,m,e,g,v,b,C,w,L,k,y,_,x,I,D,S,M,P,A,B,O,T,E,j,N,z,V,U,R,F,Z,J,q,G,K,W,H,Y,X,Q,ee,te,ne,ae,oe,ie,re,se,ce,le,ue,de,pe,fe,he,me,ge=window.cl,ve=$("body");function be(){q=ge.resultSetManager.create()}function Ce(){var e=document.querySelector('#searchform input[name="min_auto_miles"]'),t=document.querySelector('#searchform input[name="max_auto_miles"]');function n(e){e=e.replace(/\D/g,"");return 0===e.length?"":parseInt(e)}function a(e){return e?n(e+"").toLocaleString():""}e&&t&&(Number.prototype.toLocaleString||(Number.prototype.toLocaleString=function(){return this.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}),[e,t].forEach(function(e){e.value=a(e.value)}),[e,t].forEach(function(e){e.addEventListener("keyup",function(e){var t;this.value=(t=e,e=this.value,t=t.key.toLowerCase(),(e=n(e))<1e4&&"k"===t&&(e*=1e3),1e7<e&&(e=Math.floor(e/10)),a(e))})}),me||(me=!0,document.querySelector("#searchform").addEventListener("submit",function(){e&&t&&[e,t].forEach(function(e){e.value=n(e.value)})})))}ve.hasClass("search")&&($("span.icon-locate").on("click",function(e){e.preventDefault(),e.stopPropagation(),reverseGeocodeUser({onSuccess:function(e){var t=e[0],n=$("input.postal"),e=$("input.search_distance");n.val(t.postal),e.val(Math.round(t.radius)),$("button.searchbtn").click()},onError:function(e){alert(e)},extra:{src:"sr"}})}),n={},a=$("input[name=searchNearby]"),o=$(".nearbyAreas").find("input[name=nearbyArea]"),i=$("#nearbyNumber"),(r=$(".nextNearbyZone")).on("click",function(){var e=$(this),t=Number(e.data("zone"));if($(".nearbyZone.nearbyZone_"+t).removeClass("nearbyZone"),$(".nearbyZone").length){for(var n=0;0===n&&t<4;)t++,n=$(".nearbyZone.nearbyZone_"+t).length,e.data("zone",t);i.text(n)}else e.hide()}),$(".duplicate-row").each(function(){var t=$(this),n=t.find(".duplicate-rows");t.find(".expand").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.toggleClass("expanded"),t.hasClass("expanded")&&"grid"===CL.page.viewMode&&n.find(".result-row").each(function(e,t){CL.swipe.makeGallery($(t))})}),t.find(".collapsed-trash").on("click",function(e){e.stopPropagation(),e.preventDefault(),CL.banish.ban(t.data("pid")),t.find(".result-row").each(function(e,t){CL.banish.ban($(t).data("pid"))}),t.detach(),p()})}),ge.localStorage.then(function(e){var t=(n=e.getJsonItem("chosenLocals",!0))&&0<Object.keys(n).length;n=n||{},a.is(":checked")&&o.each(function(){var e=$(this);t&&(!0===n[e.val()]?(e.parent().parent().removeClass("nearbyZone"),e.attr("checked","checked")):"boolean"==typeof n[e.val()]&&e.removeAttr("checked"))}),i.text($(".nearbyZone.nearbyZone_"+r.data("zone")).length),a.removeClass("autosubmit"),a.off("click").on("click",function(){$(".nearbyArea").each(function(){$(this).removeAttr("disabled")}),m.submit()})}),o.each(function(){var t=$(this);t.on("click",function(){var e=t.val();t.is(":checked")?n[e]=!0:n[e]=!1,ge.localStorage.setJsonItem("chosenLocals",n,!0)})}),t=$("a.to-banish-page-link"),s=$(".banished_count"),c=$(".banished_count_shown"),l=$(".banish-out-of"),u=$(".banish-count-only"),(d=1===$(".my-banished").length)&&$(".category").each(function(){var t=$(this);t.off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$("#categories-hidden").val(t.prev().attr("value")),$("#searchform").submit()})}),p=function(){var e=CL.banish.banishedCount();s.text(CL.banish.banishedCountForDisplay()),c.text($(".banished").length),l.toggle(e!==parseInt($(".banished").length,10)),u.toggle(e===parseInt($(".banished").length,10)),t.attr("href","/favorites?uf=1&fl="+CL.banish.encode()),ve.toggleClass("has-banished",Boolean(e)),0===e&&"map"!==CL.page.viewMode&&CL.banish.hide()},CL.banish.ready.done(function(){ve.on("click",".banish",function(e){e.stopPropagation(),e.preventDefault(),CL.banish.ban($(this).closest(".result-row").data("pid"))}),ve.on("click",".unbanish, .restore-link",function(e){var t=$(this).closest(".result-row"),n=t.data("pid");t.remove(),CL.banish.unban(n),e.stopPropagation(),e.preventDefault()});var o=!1;CL.banish.events.on("banish unbanish",function(t,n){var a;o||(o=!0,(a=$(".result-row[data-pid="+n+"]")).length&&ge.getBfp3(function(e){("banish"===t.type?$.ajax({type:"POST",url:ge.apiUrlMap.flag,data:{async:"async",flagCode:35,postingID:n,browserinfo3:ge.safeJsonStringify(e)},xhrFields:{withCredentials:!0}}).done(function(){o=!1,a.addClass("banished"),CL.favorites.isFavorite(n)&&a.find(".icon-star").trigger("click")}):$.ajax({type:"POST",url:ge.apiUrlMap.flag,data:{async:"async",flagCode:36,postingID:n,browserinfo3:ge.safeJsonStringify(e)},xhrFields:{withCredentials:!0}}).done(function(){o=!1,a.removeClass("banished").addClass("restored")})).fail(function(){o=!1})}),p())}),$(".result-row").each(function(){var e=$(this),t=e.data("pid"),n=e.data("repost-of");(CL.banish.isBanished(t)||CL.banish.update(n,t))&&e.addClass("banished"),d&&!CL.banish.isBanished(t)&&e.removeClass("banished").addClass("restored")}),$(".duplicate-row").each(function(){var n=$(this),e=n.find(".duplicate-rows"),t=n.find(".expand.first"),a=t.find(".expand-toggle");e.find(".result-row").each(function(){var t=$(this);t.find(".icon-trash").on("click",function(){CL.banish.ban(t.data("pid"));var e=a.text()-1;a.text(e),0==e&&n.find(".expand.first").detach()})});var o,i=e.find(".result-row").not(".banished"),r=1+i.length;n.hasClass("banished")&&0<--r&&((o=$(i[0]).detach()).addClass("duplicate-row"),e=e.detach(),t=t.detach(),n.replaceWith(o),e.insertAfter(o.find(".result-info")),$(o.find("span.banish.icon")[0]).after(t),o.find(".expand").off("click").on("click",function(e){e.preventDefault(),e.stopPropagation(),o.toggleClass("expanded")}),(e=$(o.find(".icon-trash")[0])).addClass("collapsed-trash"),e.off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),CL.banish.ban(o.data("pid")),o.find(".result-row").each(function(e,t){CL.banish.ban($(t).data("pid"))})})),1===r?t.detach():0===r?n.detach():a.text(r-1)}),p()}).fail(function(){$(".banish-unbanish").hide()}),ue=function(e){var t=(e||window.location.pathname).replace(/\/d\/[^\/]*/g,"").split("/").filter(Boolean),e=t.shift(),n={category:t.pop(),subArea:t.pop(),area:window.location.hostname.split(".")[0],isSearch:"search"===e,isFavorites:"favorites"===e,purveyor:void 0};window.purveyorCategories&&Object.keys(window.purveyorCategories).some(function(e){if(window.purveyorCategories[e]===n.category)return n.purveyor=e,1});function a(e){return o.hasOwnProperty(e)&&o[e]}var o=Object.create(n),i={category:function(e){return void 0===e?o.category:(o.category=e,i)},subArea:function(e){return void 0===e?o.subArea:(o.subArea=e,i)},area:function(e){return void 0===e?o.area:(o.area=e,i)},purveyor:function(e){if(void 0===e)return o.purveyor;var t={o:"owner",d:"dealer",a:"all"};t[e]&&(e=t[e]);t={owner:1,dealer:1,all:1};if(!t[e])throw new Error("Invalid purveyor type! Must be one of: "+Object.keys(t).join(" "));return o.purveyor=e,i},isSearch:function(e){return e?(o.isSearch=Boolean(e),o.isFavorites=!1,i):o.isSearch},isFavorites:function(e){return e?(o.isFavorites=Boolean(e),o.isSearch=!1,i):o.isFavorites},toString:function(){var e="",t=[];return a("area")&&(e="//"+o.area+"."+CL.url.baseDomain),o.isSearch?(window.purveyorCategories&&a("purveyor")&&window.purveyorCategories[o.purveyor]&&(o.category=window.purveyorCategories[o.purveyor]),t=["search",o.subArea,o.category]):o.isFavorites&&(t=["favorites"]),(t=t.filter(Boolean)).unshift(""),e+t.join("/")}};return i},f=function(e){var t,n=e.delimiter||"-",a=[];if("string"==typeof e.values?a=(a=e.values.trim())?a.split(n).map(Number):[]:e.values&&e.values.length&&(a=e.values.map(Number)),e.isUncompressed)t=a;else if(0<a.length){t=[a[0]];for(var o=1;o<a.length;o++)t.push(t[o-1]+a[o])}else t=[];return{real_values:t=t.sort(function(e,t){return e-t}),add:function(e){var t=this;return e.map(Number).map(function(e){t.real_values.push(e)}),this.real_values=this.real_values.sort(function(e,t){return e-t}),t},remove:function(e){e=e.map(Number);for(var t={},n=0;n<e.length;n++)t[e[n]]=!0;for(var a=[],n=0;n<this.real_values.length;n++)t[this.real_values[n]]||a.push(this.real_values[n]);return a=a.sort(function(e,t){return e-t}),this.real_values=a,this},asDiffArray:function(){if(0===this.real_values.length)return[];for(var e=[this.real_values[0]],t=1;t<this.real_values.length;t++){var n=this.real_values[t]-this.real_values[t-1];0<n&&e.push(n)}return e},asDiffString:function(){return this.asDiffArray().join(n)},asFullArray:function(){return this.real_values.slice(0)}}},h=$(window),m=$("#searchform"),e=$("#searchform a.reset"),g=new ue,b=$("#query"),C=$(".categories").find("input[type=checkbox]").not(".selectallcb").removeAttr("name"),w=$("#excats"),m.on("submit",function(){var n,e,t;e=C.not(":checked"),t="",e.length!==C.length-1||g.isFavorites()?(n=[],e.length===C.length&&0<C.length&&!g.isFavorites()&&g.category(window.sectionAbb),e.each(function(e,t){t=t.value.split(",");n=n.concat(t)}),t=f({values:n,isUncompressed:!0}).asDiffString()):g.category(C.filter(":checked").data("abb")),w.val(t),v.each(function(){var e,t=$(this),n=t.val();e=t,""!==n?e.renameAttr("data-name","name"):e.renameAttr("name","data-name"),n=n,((t=t).hasClass("min")||t.hasClass("max"))&&t.val(n.replace(/[.,]\d{1,2}$/,"").replace(/[^\d.,k]/g,""))}),m.attr("action",g)}),L=$("#map"),k=function(){var e=Math.round($("footer").offset().top-L.offset().top-1);L.height(e),CL.maps.map&&CL.maps.map.invalidateSize(),CL.maps.map&&!$(".leaflet-control-zoom").length&&CL.maps.map.addControl(CL.maps.controls.fullsize),CL.maps.thawMap()},y=function(){CL.maps.map&&CL.maps.map.closePopup(CL.maps.openPopup),$(".leaflet-control-zoom").length&&CL.maps.map.removeControl(CL.maps.controls.fullsize),L.height(200),L.removeClass("fullsize-map"),CL.maps.freezeMap()},_={},x=0,D=(I="changed_input")+" clickme",S=$(".searchbtn"),M=$(".searchlink"),P=!1,A=function(e,t,n,a,o){e!==Boolean(_[t])&&(n.toggleClass(I,e),_[t]=!_[t],x+=e?1:-1,P=Boolean(x),S.toggleClass(D,P),M.toggleClass(D,P),o&&o(t,n,a))},B=function(e){var t,n,a,o,r,i=$(e);t=e,n=i.hasClass("multi_checkbox")||i.hasClass("use-id"),a=void 0,e=i.hasClass("multi_checkbox")?function(e,t,n){var a=$("#headerattr_"+n.data("attr")),o=Number(a.data("checked-count"))||0;n.prop("checked")?o++:o--,a.data("checked-count",o),a.removeClass("strong"),0<o&&a.addClass("strong")}:void 0,i=$(t),r=i[0].type,t=n?i.attr("id"):i.attr("name"),void 0===a||void 0===a[t]?(o="checkbox"===r?i.prop("checked"):("radio"===r?n?$("input[id="+i.attr("id")+"]:checked"):$("input[name="+i.attr("name")+"]:checked"):i).val(),a&&(a[t]=o)):o=a[t],i.off("change keyup").on("change keyup",function(n,a,o,i){if("checkbox"===r)return function(){A(n.prop("checked")!=o,a,n.parent(),n,i)};if("radio"!==r)return function(e,t){A(n.val()!==o,a,t||n,t||n,i)};var e=$("input[name="+n.attr("name")+"]");return function(){A(e.filter(":checked").val()!==o,a,e.parent(),e,i)}}(i,t,o,e))},O=$("#gallerycarousel").html().trim(),ve.on("click",".result-row .arrow",function(e){e.preventDefault()}),T=function(e,t,n){return'<img alt="" class="'+(n=n||"")+'" src="'+CL.image.url(e,t)+'">'},E={},j={},N=function(i){$(".result-row").each(function(e,t){var n,t=$(t),e=e+"-"+t.data("pid"),a=t.find("> .result-image"),o=a.data("idList");Array.isArray(o)||(o=(o=a.data("ids")||"")?o.split(","):[],a.data("idList",o)),0===o.length?a.addClass("empty").attr("title",window.noImageText):"thumb"!==i||E[e]?"gallery"!==i||j[e]||(j[e]=!0,1===o.length?a.prepend(T(o[0],"gallery")):(t=o.map(function(e,t){return"<div>"+(0===t?T(e,"gallery"):"")+"</div>"}).join(""),a.append('<div class="swipe"><div class="swipe-wrap">'+t+"</div></div>"+O),n=!1,CL.swipe.makeGallery(a,{callback:function(){n||(a.find(".swipe-wrap div").each(function(e,t){0!==e&&$(t).html(T(o[e]||o[e-o.length],"gallery"))}),n=!0)}}))):(E[e]=!0,a.prepend(T(o[0],"thumb","thumb")))})},z={},V=function(e){var t="cl_tocmode";if(void 0===e){var n=CL.cookies.getItem(t);return n&&n.split(",").forEach(function(e){e=e.split(":"),z[e[0]]=e[1]}),z[window.sectionBase]||window.defaultView}n=new Date;n.setTime(n.getTime()+31536e6),z[window.sectionBase]=e;e=Object.keys(z).map(function(e){return e+":"+z[e]}).join(",");CL.cookies.removeItem(t),CL.cookies.setItem(t,e,{expires:n})},$(".backtotop").on("click",function(e){$(window).scrollTop(0),e.preventDefault()}),CL.page.viewMode=V(),(R=CL.page.setViewMode=function(e,t){t&&(E={},j={});t={list:function(){y()},pic:function(){var t,n,a;CL.browser.isTouchCapable||(t=$("#floater"),n=t.find("img.payload"),a=!1,$(".result-image").on("mouseover",function(){var e=($(this).data("idList")||[])[0];e&&(t.show(),n.attr("src",CL.image.url(e,"gallery")).on("load",function(){$("#floater").addClass("f")}),a=!0)}).on("mouseout",function(){t.hide().removeClass("f"),n.attr("src",""),a=!1}).on("mousemove",function(e){a&&$("#floater").css({left:e.pageX+15+"px",top:e.pageY+15+"px"})})),y(),N("thumb")},grid:function(){y(),$(".result-image").off(),$("#floater").hide(),N("gallery")},map:function(){CL.maps.init(),$("#mapcontainer").css({height:"99%"}),k(),CL.page.isMobile&&CL.maps.controls.fullsize.fullscreen(),CL.maps.countMarkers()}};U=CL.page.viewMode,CL.page.oldMode=U,/^BB/.test(CL.cookies.getItem("cl_b"))&&$.ajax("/stats",{type:"HEAD",data:{type:"search-view-mode",from:U,to:e}}),t[e]&&$("#"+e+"view").length||(e="list"),ve.removeClass(Object.keys(t).join(" ")).addClass(e),t[CL.page.viewMode=e](),V(e)})(CL.page.viewMode),$(".open-map-view-button").on("click",function(){R("map"),$(".dropdown").trigger("updateView")}),$(".search-view .dropdown").dropdown({onSelect:function(e){e.preventDefault();e=$(e.target).data("selection");e!==CL.page.viewMode&&R(e)}}),$(".search-sort .dropdown").dropdown(),F=$("#is_paid"),$(".remuneration").on("click","a",function(e){e.preventDefault(),F.val($(this).data("val")),m.submit()}),$(".purveyor").on("click","a",function(e){e.preventDefault(),g.purveyor($(this).data("val")),m.submit()}),$("input[name=srchType]").on("click",function(){b.val()&&m.submit()}),$(".savealert a").on("click",function(e){var n=this,a=n.href;e.preventDefault(),$.ajax("/session/?v=1",{dataType:"json",timeout:1500}).done(function(e){var t;window.location.href=a+"&_csrf="+encodeURIComponent(e.csrf),P&&(t=$(n).data("action"),m.append('<input type="hidden" name="'+t+'" value="1">').append('<input type="hidden" name="_csrf" value="'+e.csrf+'">').submit())}).fail(function(){var e;window.location.href=a,P&&(e=$(n).data("action"),m.append('<input type="hidden" name="'+e+'" value="1">').submit())})}),$(".experimentalFeature a").on("click",function(e){var t=$(this).data("query");t&&(e.preventDefault(),b.val(t),m.submit())}),function(){var e=$(".morecats"),t=$(".othercats"),n=$(".search-options-container"),a=$(".search-options-header");t.hasClass("closed");e.on("click",function(){t.add(e).toggleClass("closed")}),$(".form-tab").on("click",function(){var e=ve.toggleClass("hide-search").hasClass("hide-search")?1:0;k(),CL.cookies.setItem("hidesearch",e)}),a.on("click",function(){n.toggleClass("options-visible"),a.toggleClass("options-visible")})}(),$(".search-attribute").each(function(e,t){var n=$(t),a=(n.data("attr"),n.find(".title")),o=n.find(".list"),i=o.find(".selectall"),r=o.find(".moreless"),s=o.find(".multi_checkbox");a.on("click",function(){n.toggleClass("hide-list")}),o.on("change",".multi_checkbox",function(){var e=0<s.filter(":checked").length;i.toggleClass("selected",e),a.toggleClass("strong",e)}),i.on("click",".all",function(){s.prop("checked",!0).trigger("change"),r.find(".more").trigger("click")}),i.on("click",".none",function(){s.prop("checked",!1).trigger("change")}),r.on("click",".more",function(){o.removeClass("short-list")}),r.on("click",".less",function(){o.addClass("short-list")})}),Z=$(".catcheck").not(".selectallcb"),J=$(".catcheck.selectallcb"),Z.on("change",function(){var e=$(this),t=f({values:$("#breadcrumbform #excats").val()});(Z.not(":checked").length?J.prop("checked",!1):J.prop("checked",!0)).trigger("change"),e.prop("checked")?t.remove(e.val().split(",").map(Number)):t.add(e.val().split(",").map(Number)),$("#searchform #excats,#breadcrumbform #excats").val(t.asDiffString()),e.closest(".selectall").toggleClass("checked").closest(".searchgroup").find("input[type=checkbox]").not(e).prop("checked",e.prop("checked")).trigger("change")}),J.on("click",function(){var e=$(this).prop("checked");Z.each(function(){$(this).prop("checked",e).trigger("change")})}),ge.localStorage.whenPersistent(function(){be(),q&&ve.on("click",".hdrlnk, .paginator a, a.result-image",q.makeCurrent)}),ge.localStorage.whenPersistent(function(){var e,t=ge.localStorage.getItem("scrollToPost");t&&(ge.localStorage.removeItem("scrollToPost"),"map"!==CL.page.viewMode&&(e="grid"===CL.page.viewMode?350:"pic"===CL.page.viewMode?180:140,(t=document.getElementById("postid_"+t))&&t.scrollIntoView&&(t.scrollIntoView(),t.focus(),window.scrollTo(0,window.scrollY-e))))}),CL.browser.pushState&&(G=120,K=CL.url.params(),W=$(".rows"),H=$(".paginator"),Y=Math.min(Number(H.find(".totalcount").first().text()),window.maxResults),fe=H.find("a.first"),X=H.find("a.prev"),Q=H.find("a.next"),0!==(ee=Number(K.s)||0)&&0<ee%G||(te=$(".paginator .range"),ne={},ae=function(e){return!!ne[e]&&(ne[ee]=W.find(".result-row, #moon").detach(),W.prepend(ne[e]),R(CL.page.viewMode),CL.favorites.init(),!0)},oe=function(t){var e=ie({index:t,ajax:!0});!ne[t]&&0<=t&&t<Y&&$.get(e).done(function(e){ne[t]=$(e.trim()).find(".content .result-row")})},ie=function(e){(e=e||{}).index?K.s=e.index:delete K.s;var t=window.location.pathname,e=Object.keys(K).sort().map(function(e){var t=Array.isArray(K[e])?K[e].join("&"+e+"="):K[e];return e+"="+t}).join("&");return t+(e=e&&"?"+e)},re=function(){var e=ee+1,t=Math.min(ee+G,ee+ne[ee].length);te.text(e+" - "+t)},se=function(e,t,n){ae(ee+n)&&(t.preventDefault(),h.scrollTop(0),ee+=n,re(),X.attr("href",ie({index:ee-G})),Q.attr("href",ie({index:ee+G})),history.pushState({index:ee},void 0,ie({index:ee})),H.toggleClass("firstpage",0===ee),H.toggleClass("lastpage",Y<=ee+G),n<0&&oe(ee+n),"object"==typeof q&&be())},oe(ee-G),fe.on("click",function(e){se(0,e,-ee)}),X.on("click",function(e){se(0,e,-G)}),Q.on("click",function(e){se(0,e,G)}),window.onpopstate=function(e){e=e.state&&e.state.index||Number(CL.url.params().s)||0;ae(e)?(re(),ee=e):e!==ee&&window.location.reload()})),ge.autocomplete({type:"search",buildParams:function(e){return{term:e.term,cat:window.catAbb}},onSelect:function(e,t){t.item.value&&(b.val(t.item.value),m.submit())}}),ge.autocomplete({type:"makemodel",buildParams:function(e){var t=window.catAbb;window.purveyorCategories&&(t=window.purveyorCategories.all),t===window.sectionBase&&(t=void 0);e={term:e.term};return t&&(e.cat=t),e},onSelect:function(e,t){t.item.value&&($(".auto_make_model").val(t.item.value),m.submit())}}),(ce=$("#breadcrumbform").on("submit",function(){$(this).attr("action",le)})).find("select").removeAttr("name").end().find("input").each(function(){var e=$(this);""===e.val()&&e.removeAttr("name")}),$(".clear-all-banished").off("click").on("click",function(e){e.preventDefault();var t=[];$(".result-row").each(function(){var e=$(this);t.push(e.data("pid"))}),CL.favesManager.deleteBanished(t),$(".rows").empty(),p()}),le=new ue($("#breadcrumbform").attr("action")),$("#areaAbb").on("change",function(){ce.find("input[name=postal]").remove(),ce.find("input[name=search_distance]").remove(),le.area($(this).val()).subArea(""),ce.submit()}),$("#subArea").on("change",function(){le.subArea($(this).val()),ce.submit()}),$("#catAbb, #subcatAbb").on("change",function(){le.category($(this).val()).isSearch(!0),ce.find("input[name=excats]").remove(),ce.find("input[name=fl]").remove(),ce.find("input[name=uf]").remove(),ce.submit()}),fe=".event_attr_label",ue=7,de=0,fe=$(fe),pe=Math.max,fe.each(function(){var e=$(this).width();de=pe(de,e)}),de+=ue,fe.css("min-width",de),CL.browser.matchMedia&&(fe=window.matchMedia("(max-width: 480px)"),(he=function(e){e?$(".autosubmit").off("change").each(function(e,t){B(t)}):($(".autosubmit").off("change").on("change",function(){m.submit()}),$(".options-visible").removeClass("options-visible"))})(fe.matches),fe.addListener(function(e){e=e.matches;he(e)})),ve.on("click",".result-row",function(){var e;!CL.page.isMobile||(e=$(this).find(".result-info a").attr("href"))&&(window.location.href=e)}),ve.hasClass("has-map")&&("hhh"===window.sectionBase&&!["swp","hsw","sha"].includes(window.catAbb)||"sss"===window.sectionBase&&"gms"===window.catAbb)&&("desktop"!==window.pagemode||CL.url.params().s||ve.addClass("has-map-view-button")),me=!1,(ge.page.resetSearchStateWatchers=function(){x=0,S.removeClass(D),M.removeClass(D),(v=m.find("input, select, .searchInput")).not(".selectallcb").not(".autosubmit").not(".no_changed_input").each(function(e,t){B(t)}),Ce()})(),CL.maps&&e.click(CL.maps.storeCurrentBounds),CL.maps&&m.submit(CL.maps.storeCurrentBounds),CL.maps&&$("#catAbb, #subcatAbb").change(CL.maps.storeCurrentBounds),CL.maps&&m.find('input[name="search_distance"], input[name="postal"]').change(CL.maps.turnOffResetBoundsOnReload))}();var reverseGeocodeUser=window.reverseGeocodeUser=function(e){if(e&&e.onSuccess){var t=e.onSuccess,a=e.onError||function(){},n=e.extra||{};try{CL.browser.geolocation?navigator.geolocation.getCurrentPosition(function(e){n.lat=e.coords.latitude,n.lon=e.coords.longitude,n.acc=e.coords.accuracy,$.ajax({dataType:"json",url:"/codegeo",data:n,success:function(e){t(e)},error:function(e,t,n){a(t+" "+n)}})},function(e){a("Cannot get location. "+function(e){var t="";switch(e.code){case e.PERMISSION_DENIED:t="Permission Denied.";break;case e.POSITION_UNAVAILABLE:t="Location Unavailable.";break;case e.TIMEOUT:t="Timeout.";break;case e.UNKNOWN_ERROR:default:t="Unknown Error."}return t+" "+e.message}(e))},{enableHighAccuracy:!1,timeout:1e4,maximumAge:3e4}):a("Cannot get location.")}catch(e){a("Cannot get location. "+e.message)}}};
/* {"sources":{"search-concat.js":"4f0b9260db25eacc3259e336284bd7b6"}} */